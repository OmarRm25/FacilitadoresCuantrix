function getCl(cadena){var specialChars = "!@#$^&%*()+=-[]\/{}|:<>?,.";for (var i = 0; i < specialChars.length; i++) {cadena= cadena.replace(new RegExp("\\" + specialChars[i], 'gi'), '');}   cadena = cadena.toLowerCase();cadena = cadena.replace(/\s+/g," ");cadena = cadena.replace(/á/gi,"a");cadena = cadena.replace(/é/gi,"e");cadena = cadena.replace(/í/gi,"i");cadena = cadena.replace(/ó/gi,"o");cadena = cadena.replace(/ú/gi,"u");return cadena;}function valida(){return""!==document.getElementById("origen").value&&""!==document.getElementById("destino").value||($(".subcalc .msg").show(),!1)}function initOri(){Cookiebot.hide(),$(".subcalc .msg").hide(),document.getElementById("origen").value=""}function initDes(){Cookiebot.hide(),$(".subcalc .msg").hide(),document.getElementById("destino").value=""}function route(a,i,n,e,t){map=L.map("mapa").setView([a,i],t),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'<a href="http://www.openstreetmap.org/about/" rel="nofollow" target="_blank">© OpenStreetMap</a>',crossOrigin:!0}).addTo(map),map.scrollWheelZoom.disable();var o=L.Icon.extend({options:{iconSize:[22,38],iconAnchor:[11,35],popupAnchor:[-3,-76]}}),r=new o({iconUrl:ini_icon}),s=new o({iconUrl:fin_icon});L.marker([a,i],{icon:r}).addTo(map),L.marker([n,e],{icon:s}).addTo(map)}function showData(a){}function showRoute(a,i){var n="#69aff4";0==i&&(n="#babcbe"),-1==i&&(n="#572364");var e=JSON.parse(a);e=L.polyline(e,{color:n,smoothFactor:3,weight:6,opacity:.85}).addTo(map);map.fitBounds(e.getBounds(),{padding:[30,30]})}function getTramos(a,i){if(null==i)return null;var n=JSON.parse("["+i+"]");tramos=[];var e=null;for(j=0;j<n[0].length;j++){e=L.latLng(n[0][j][0],n[0][j][1]).toBounds(a),(p=[]).push(e.getNorthEast().lat),p.push(e.getSouthWest().lat),p.push(e.getNorthEast().lng),p.push(e.getSouthWest().lng);var t=p[0],o=p[1],r=(i=p[2],p[3]);tramos[j]=[t,i,o,r]}return tramos}$(document).ready(function(){document.getElementById("origen").value="",document.getElementById("destino").value="",$.typeahead({input:"#origen",minLength:3,maxItem:5,dynamic:!0,offset:!0,accent:!0,filter:!1,cancelButton:!1,source:{ajax:{type:"POST",url:get_data_url_autocomplete,data:{query:"{{query}}"}}},callback:{onNavigateBefore:function(a,i,n){~[38,40].indexOf(n.keyCode)&&(n.preventInputChange=!0)}}}),$.typeahead({input:"#destino",minLength:3,maxItem:5,dynamic:!0,offset:!0,accent:!0,filter:!1,cancelButton:!1,source:{ajax:{type:"POST",url:get_data_url_autocomplete,data:{query:"{{query}}"}}},callback:{onNavigateBefore:function(a,i,n){~[38,40].indexOf(n.keyCode)&&(n.preventInputChange=!0)}}}),$("#mapa").length>0&&$("#mapa").hide(),$("#mapa_inc").length>0&&$("#mapa_inc").hide(),$("#mapa_gas").length>0&&$("#mapa_gas").hide(),$("#incidencias").length>0&&$("#incidencias").prop("disabled",!0),$("#radares").length>0&&$("#radares").prop("disabled",!0),$("#areasdescanso").length>0&&$("#areasdescanso").prop("disabled",!0),$("#puntosnegros").length>0&&$("#puntosnegros").prop("disabled",!0),$("#form_gasolineras").length>0&&$("#form_gasolineras").find("input").attr("disabled",!0),$("#form_opciones").length>0&&$("#form_opciones").find("input").attr("disabled",!0),$("span[id=info]").length>0&&$("span[id=info]").html(""),$("#origen").blur(function(){if(document.getElementById("origen").value !== "" && document.getElementById("origen").value.indexOf(',') === -1){if($(".origen ul.typeahead__list li:first").length){var oriFirst = $(".origen ul.typeahead__list li:first").text();if(getCl(oriFirst).indexOf(getCl($("#origen").val())) !== -1){ $("#origen").val(oriFirst);}}}}),$("#destino").blur(function(){if(document.getElementById("destino").value !== "" && document.getElementById("destino").value.indexOf(',') === -1){if($(".destino ul.typeahead__list li:first").length){var desFirst = $(".destino ul.typeahead__list li:first").text();if(getCl(desFirst).indexOf(getCl($("#destino").val())) !== -1){$("#destino").val(desFirst)}};}});}),$(function(){null!=document.getElementById("ws")&&$("#ws").attr("href","whatsapp://send?text="+urlActual),$("#fb").click(function(){window.open("https://www.facebook.com/sharer/sharer.php?u="+urlActual,"facebook","width=575,height=450")}),$("#tw").click(function(){window.open("https://twitter.com/intent/tweet?text=Calcular Ruta&url="+urlActual,"twitter","width=575,height=450")}),$("#gp").click(function(){window.open("https://plus.google.com/share?url="+urlActual,"googleplus","width=575,height=450")}),$("#incidencias").click(function(){if(tramos=getTramos(100,itiSelec),null!=tramos){var a=JSON.stringify(tramos);$.ajax({url:get_data_url_incidencias,data:"quadrants="+a,dataType:"json",type:"POST",beforeSend:function(){$("span[id=notificacion]").html("<br />Buscando incidencias del tráfico ...")},success:function(a){if(1==a.success&&null!=a.incidencias){var n=new(L.Icon.extend({options:{iconSize:[28,28],popupAnchor:[-3,-76]}}))({iconUrl:warning_icon});for(null==layerGroup?layerGroup=L.layerGroup():layerGroup.clearLayers(),i=0;i<a.incidencias.length;i++)L.marker([a.incidencias[i].lat,a.incidencias[i].lon],{icon:n}).bindPopup(a.incidencias[i].descripcion).addTo(layerGroup);layerGroup.addTo(map),$("span[id=notificacion]").html("<br />Mostrando incidencias de tráfico.")}else $("span[id=notificacion]").html("<br />No se detectan incidencias de tráfico graves.")}}),$("#incidencias").prop("disabled",!0)}}),$("#radares").click(function(){if(tramos=getTramos(100,itiSelec),null!=tramos){var a=JSON.stringify(tramos);$.ajax({url:get_data_url_radares,data:"quadrants="+a,dataType:"json",type:"POST",beforeSend:function(){$("span[id=notificacion]").html("<br />Buscando radares en ruta ...")},success:function(a){if(1==a.success&&null!=a.radars){var n=new(L.Icon.extend({options:{iconSize:[28,28]}}))({iconUrl:radar_icon});for(null==layerGroup?layerGroup=L.layerGroup():layerGroup.clearLayers(),i=0;i<a.radars.length;i++)L.marker([a.radars[i].lat,a.radars[i].lon],{icon:n}).bindPopup("Radar Fijo").addTo(layerGroup);layerGroup.addTo(map),$("span[id=notificacion]").html("<br />Mostrando radares.")}else $("span[id=notificacion]").html("<br />No se detectan radares fijos. Ten en cuenta que no se informa de radares móviles ni de algunos radares de tramo.")}}),$("#radares").prop("disabled",!0)}}),$("#areasdescanso").click(function(){if(tramos=getTramos(300,itiSelec),null!=tramos){var a=JSON.stringify(tramos);$.ajax({url:get_data_url_servicios,data:"quadrants="+a,dataType:"json",type:"POST",beforeSend:function(){$("span[id=notificacion]").html("<br />Buscando áreas de servicio ...")},success:function(a){if(1==a.success&&null!=a.areasdedescanso){var n=new(L.Icon.extend({options:{iconSize:[28,28]}}))({iconUrl:services_icon});for(null==layerGroup?layerGroup=L.layerGroup():layerGroup.clearLayers(),i=0;i<a.areasdedescanso.length;i++)L.marker([a.areasdedescanso[i].lat,a.areasdedescanso[i].lon],{icon:n}).bindPopup("Área de servicio").addTo(layerGroup);layerGroup.addTo(map),$("span[id=notificacion]").html("<br />Mostrando áreas de servicio.")}else $("span[id=notificacion]").html("<br />No se encuentran áreas de servicio.")}}),$("#areasdescanso").prop("disabled",!0)}}),$("#puntosnegros").click(function(){if(tramos=getTramos(100,itiSelec),null!=tramos){var a=JSON.stringify(tramos);$.ajax({url:get_data_url_pn,data:"quadrants="+a,dataType:"json",type:"POST",beforeSend:function(){$("span[id=notificacion]").html("<br />Buscando puntos negros.")},success:function(a){if(1==a.success&&null!=a.puntosnegros){var n=new(L.Icon.extend({options:{iconSize:[28,28]}}))({iconUrl:pn_icon});for(null==layerGroup?layerGroup=L.layerGroup():layerGroup.clearLayers(),i=0;i<a.puntosnegros.length;i++)L.marker([a.puntosnegros[i].lat,a.puntosnegros[i].lon],{icon:n}).bindPopup("Punto negro").addTo(layerGroup);layerGroup.addTo(map),$("span[id=notificacion]").html("<br />Mostrando puntos negros.")}else $("span[id=notificacion]").html("<br />No se detectan puntos negros.")}}),$("#puntosnegros").prop("disabled",!0)}}),$("input[name='gasolinas']").change(function(){null!=iniPointY&&null!=iniPointX&&(tipo=$("input[name=gasolinas]:checked","#form_gasolineras").val(),$.ajax({url:get_data_url_gasolineras,data:"lat="+iniPointX+"&lon="+iniPointY+"&tipo="+tipo,dataType:"json",type:"POST",success:function(a){map.setView([iniPointX,iniPointY],13),null==layerGroup?layerGroup=L.layerGroup():(layerGroup.clearLayers(),$("span[id=gasolinera_barata]").html(""),$("span[id=precio_barato]").html(""),$("span[id=notificacion]").html(""));var n=L.Icon.extend({options:{iconSize:[28,28]}}),e=new n({iconUrl:gas_icon}),t=new n({iconUrl:cheap_gas_icon});for(i=0;i<a.length;i++)0==i?(L.marker([a[i].lon,a[i].lat],{icon:t}).bindPopup(a[i].precio+" litro").addTo(layerGroup),$("span[id=gasolinera_barata]").html(a[i].direccion+" "+a[i].localidad),$("span[id=precio_barato]").html(a[i].precio),$("span[id=notificacion]").html("")):L.marker([a[i].lon,a[i].lat],{icon:e}).bindPopup(a[i].precio+" litro").addTo(layerGroup);layerGroup.addTo(map)}}))}),$("#cmapa").click(function(){$(this).hide(),$("#mapa").delay(1e3).show(),$("#link").length>0&&(urlActual=$("#link").val()),$.ajax({url:get_data_url_direction,data:"query="+urlActual,dataType:"json",type:"POST",success:function(a){if(1==a.success&&null!=a.rutas){for($("#mapa").delay(1e3).show(),$("#incidencias").prop("disabled",!1),$("#radares").prop("disabled",!1),$("#areasdescanso").prop("disabled",!1),$("#puntosnegros").prop("disabled",!1),$("#form_gasolineras").find("input").attr("disabled",!1),iniPointX=a.rutas.iniPointX,iniPointY=a.rutas.iniPointY,finPointX=a.rutas.finPointX,finPointY=a.rutas.finPointY,zoom=a.rutas.zoom,route(iniPointX,iniPointY,finPointX,finPointY,zoom),(itinerarios=a.rutas.itinenarios).length>1&&$("#form_opciones").find("input").attr("disabled",!1),$("#form_opciones").find("#peaje").attr("disabled",!0),$ppeaje=!1,$altern=!1,i=0;i<itinerarios.length;i++)0==i?(itiSelec=itinerarios[i].puntos,$("span[id=distancia]").html(itinerarios[i].distancia),$("span[id=duracion]").html(itinerarios[i].duracion),$("div[id=instrucciones]").html(itinerarios[i].instrucciones),1==itinerarios[i].peaje&&($ppeaje=!0),$("span[id=info]").append(itinerarios[i].aviso)):(1==itinerarios[i].peaje&&($altern=!0),showRoute(itinerarios[i].puntos,0));1==$ppeaje&&1==$altern&&$("#form_opciones").find("#peaje").attr("disabled",!1),showRoute(itiSelec,1)}}})}),$("input[name='itinerarios']").change(function(){if(tipo=$("input[name=itinerarios]:checked","#form_opciones").val(),$("#incidencias").length>0&&$("#incidencias").prop("disabled",!1),$("#radares").length>0&&$("#radares").prop("disabled",!1),$("#areasdescanso").length>0&&$("#areasdescanso").prop("disabled",!1),$("#puntosnegros").length>0&&$("#puntosnegros").prop("disabled",!1),$("#form_gasolineras").length>0&&$("#form_gasolineras").find("input").attr("disabled",!1),$("span[id=info]").length>0&&$("span[id=info]").html(""),null==layerGroup?layerGroup=L.layerGroup():(layerGroup.clearLayers(),$("span[id=gasolinera_barata]").html(""),$("span[id=precio_barato]").html(""),$("span[id=notificacion]").html("")),0==tipo){for(i=0;i<itinerarios.length;i++)0==i?(itiSelec=itinerarios[i].puntos,$("span[id=distancia]").html(itinerarios[i].distancia),$("span[id=duracion]").html(itinerarios[i].duracion),$("span[id=info]").html(itinerarios[i].aviso),$("div[id=instrucciones]").html(""),$("div[id=instrucciones]").html(itinerarios[i].instrucciones)):showRoute(itinerarios[i].puntos,0);showRoute(itiSelec,1)}else if(1==tipo){for(a=itinerarios.length-1;a>=0;a--)1==a?(itiSelec=itinerarios[a].puntos,$("span[id=distancia]").html(itinerarios[a].distancia),$("span[id=duracion]").html(itinerarios[a].duracion),$("span[id=info]").html(itinerarios[a].aviso),$("div[id=instrucciones]").html(""),$("div[id=instrucciones]").html(itinerarios[a].instrucciones)):showRoute(itinerarios[a].puntos,0);showRoute(itiSelec,1)}else $.ajax({url:get_data_url_direction_no_toll,data:"query="+urlActual,dataType:"json",type:"POST",success:function(a){if(1==a.success&&null!=a.rutas){for($("#mapa").delay(1e3).show(),$("#incidencias").prop("disabled",!1),$("#radares").prop("disabled",!1),$("#areasdescanso").prop("disabled",!1),$("#puntosnegros").prop("disabled",!1),$("#form_gasolineras").find("input").attr("disabled",!1),$("#form_opciones").find("input").attr("disabled",!1),iniPointX=a.rutas.iniPointX,iniPointY=a.rutas.iniPointY,finPointX=a.rutas.finPointX,finPointY=a.rutas.finPointY,zoom=a.rutas.zoom,i=0;i<itinerarios.length;i++)showRoute(itinerarios[i].puntos,0);showRoute(itiSelec=a.rutas.itinenarios[0].puntos,-1),$("span[id=info]").html("Se encuentra una ruta alternativa sin peajes, si sales ahora llegarás sobre las "+a.rutas.itinenarios[0].llegada),$("span[id=distancia]").html(a.rutas.itinenarios[0].distancia),$("span[id=duracion]").html(a.rutas.itinenarios[0].duracion),$("div[id=instrucciones]").html(""),$("div[id=instrucciones]").html(a.rutas.itinenarios[0].instrucciones),$("#form_opciones").find("#peaje").attr("disabled",!0)}else $("span[id=info]").html("No se encuentra una ruta alternativa sin peajes")}})}),$("#cmapa_inc").click(function(){$(this).hide(),$("#mapa_inc").delay(1e3).show(),$("#link").length>0&&(urlActual=$("#link").val()),$.ajax({url:get_data_url_inc,data:"query="+urlActual,dataType:"json",type:"POST",success:function(a){if(1==a.success&&null!=a.incidencias){map_inc=0==a.todos?L.map("mapa_inc").setView([a.incidencias[0].lat,a.incidencias[0].lon],8):L.map("mapa_inc").setView([40.4166876,-3.7037766],5),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'<a href="http://www.openstreetmap.org/about/" target="_blank">© OpenStreetMap</a>',crossOrigin:!0}).addTo(map_inc),map_inc.scrollWheelZoom.disable();var n=new(L.Icon.extend({options:{iconSize:[28,28],popupAnchor:[-3,-76]}}))({iconUrl:warning_icon});for(null==layerGroup?layerGroup=L.layerGroup():layerGroup.clearLayers(),i=0;i<a.incidencias.length;i++)L.marker([a.incidencias[i].lat,a.incidencias[i].lon],{icon:n}).bindPopup(a.incidencias[i].descripcion).addTo(layerGroup);layerGroup.addTo(map_inc)}}})}),$("#cmapa_gas").click(function(){$(this).hide(),$("#mapa_gas").delay(1e3).show(),$("#link").length>0&&(urlActual=$("#link").val()),$.ajax({url:get_data_url_gas,data:"query="+urlActual,dataType:"json",type:"POST",success:function(a){if(1==a.success&&null!=a.gas_stations){map_gas=L.map("mapa_gas").setView([a.gas_stations[0].lat,a.gas_stations[0].lon],11),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'<a href="http://www.openstreetmap.org/about/" target="_blank">© OpenStreetMap</a>',crossOrigin:!0}).addTo(map_gas),map_gas.scrollWheelZoom.disable();var n=new(L.Icon.extend({options:{iconSize:[28,28]}}))({iconUrl:gas_icon});for(null==layerGroup?layerGroup=L.layerGroup():layerGroup.clearLayers(),i=0;i<a.gas_stations.length;i++)L.marker([a.gas_stations[i].lat,a.gas_stations[i].lon],{icon:n}).bindPopup(a.gas_stations[i].direccion+"<br/>"+a.gas_stations[i].rotulo+"<br />"+a.gas_stations[i].horario+"<br />").addTo(layerGroup);layerGroup.addTo(map_gas)}}})})}),layerGroup=null;var map=null,map_inc=null,map_gas=null,iniPointX=null,iniPointY=null,finPointX=null,finPointY=null,zoom=null,itinerarios=null,itiSelec=null;urlActual=window.location,get_data_url_autocomplete="/autocompletar/",get_data_url_direction="/itinerarios/",get_data_url_direction_no_toll="/itinerarios-sin-peajes/",get_data_url_gasolineras="/gasolineras-en-ruta/",get_data_url_radares="/radares-en-ruta/",get_data_url_incidencias="/incidencias-en-ruta/",get_data_url_radares="/radares-en-ruta/",get_data_url_pn="/puntos-negros-en-ruta/",get_data_url_servicios="/areas-descanso-en-ruta/",get_data_url_inc="/incidencias/",get_data_url_gas="/gasolineras-en-provincia/",ini_icon="/user-content/templates/rutas/public/images/a.png",fin_icon="/user-content/templates/rutas/public/images/b.png",gas_icon="/user-content/templates/rutas/public/images/gas-station.png",cheap_gas_icon="/user-content/templates/rutas/public/images/gas-station-cheap.png",radar_icon="/user-content/templates/rutas/public/images/radar.png",warning_icon="/user-content/templates/rutas/public/images/warning.png",pn_icon="/user-content/templates/rutas/public/images/pn.png",services_icon="/user-content/templates/rutas/public/images/services.png";